<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:p="http://primefaces.org/ui"
      lang="ru">
    <h:head>
        <title>Jakarta Server Facepalm</title>
        <h:outputScript library="js" name="graph.js" target="body"/>
        <h:outputStylesheet name="slider.css" library="css" />
        <h:outputStylesheet name="graph.css" library="css" />
        <h:outputStylesheet name="footer.css" library="css" />
    </h:head>

    <h:body>
        <h:panelGrid columns="2" style="width: 100%" >
            <h:form>
                <h:panelGrid columns="3" style="margin-bottom: 10px" >
                    <h:outputText value="Выбранное значение параметра X: " style="padding-right: 15px;" />
                    <h:outputText id="xDisplay" value="#{attempt.point.x}"
                                  style="display: inline-block; min-width: 40px;" >
                        <f:convertNumber minFractionDigits = "2" />
                    </h:outputText>
                    <p:slider for="hiddenX" display="xDisplay" type="vertical" minValue="-2.0" maxValue="2.0" step="0.5"
                              styleClass="slider" />
                    <h:inputHidden id="hiddenX" value="#{attempt.point.x}" />
                </h:panelGrid>

                <h:panelGrid columns="3" style="margin-bottom: 10px" >
                    <h:outputText value="Выбранное значение параметра Y: " />
                    <p:inputNumber value="#{attempt.point.y}"
                                   required="true"
                                   requiredMessage="Не введено значение поля Y"
                                   validatorMessage="Y должен быть числом от -5 до 5" >
                        <f:validateDoubleRange minimum="-5" maximum="5" />
                    </p:inputNumber>
                </h:panelGrid>

                <h:panelGrid columns="3" style="margin-bottom: 10px" >
                    <h:outputText value="Выбранное значение параметра R: " style="padding-right: 15px;" />
                    <h:outputText id="rDisplay" value="#{attempt.point.r}"
                                  style="display: inline-block; min-width: 40px;">
                        <f:convertNumber minFractionDigits = "2" />
                    </h:outputText>
                    <p:slider for="hiddenR" display="rDisplay" type="vertical" minValue="-2.0" maxValue="5.0" step="0.1"
                              styleClass="slider" widgetVar="rSliderWidget"
                              onSlide="drawGraph(event, ui);" />
                    <h:inputHidden id="hiddenR" value="#{attempt.point.r}" />
                </h:panelGrid>

                <p:commandButton value="Обновить" update="table @form"
                                 action="#{keeper.add(attempt)}"
                                 onclick="drawDefaultPoint();" />

                <p:commandButton value="Очистить" update="table"
                                 action="#{keeper.clear()}"
                                 oncomplete="document.getElementById('graph').querySelectorAll('circle').forEach(c => c.remove());"/>

                <p:growl showDetail="true"
                         showSummary="false"
                         life="5000"
                         sticky="false"
                         style="position: fixed; top: 20px; right: 20px; width: 300px;"
                         autoUpdate="true"/>
            </h:form>
            <h:panelGrid columns="1" style="text-align: right; margin-right: 5px" >
                <svg id="graph" xmlns="http://www.w3.org/2000/svg"
                     width="500"
                     height="500"
                     style="margin-right: 5px">

                    <line class="axis" x1="0" y1="250" x2="500" y2="250" />
                    <line class="axis" x1="250" y1="0" x2="250" y2="500" />

                    <line class="axis" x1="290" y1="248" x2="290" y2="252" />
                    <line class="axis" x1="330" y1="248" x2="330" y2="252" />
                    <line class="axis" x1="370" y1="248" x2="370" y2="252" />
                    <line class="axis" x1="410" y1="248" x2="410" y2="252" />
                    <line class="axis" x1="450" y1="248" x2="450" y2="252" />

                    <line class="axis" x1="210" y1="248" x2="210" y2="252" />
                    <line class="axis" x1="170" y1="248" x2="170" y2="252" />
                    <line class="axis" x1="130" y1="248" x2="130" y2="252" />
                    <line class="axis" x1="90" y1="248" x2="90" y2="252" />
                    <line class="axis" x1="50" y1="248" x2="50" y2="252" />

                    <line class="axis" x1="248" y1="210" x2="252" y2="210" />
                    <line class="axis" x1="248" y1="170" x2="252" y2="170" />
                    <line class="axis" x1="248" y1="130" x2="252" y2="130" />
                    <line class="axis" x1="248" y1="90" x2="252" y2="90" />
                    <line class="axis" x1="248" y1="50" x2="252" y2="50" />

                    <line class="axis" x1="248" y1="290" x2="252" y2="290" />
                    <line class="axis" x1="248" y1="330" x2="252" y2="330" />
                    <line class="axis" x1="248" y1="370" x2="252" y2="370" />
                    <line class="axis" x1="248" y1="410" x2="252" y2="410" />
                    <line class="axis" x1="248" y1="450" x2="252" y2="450" />


                    <polygon class="axis" points="500,250 495,255 495, 245" />
                    <polygon class="axis" points="250,0 245,5 255,5" />


                    <path id="circle" class="figure"
                          d="" />

                    <polygon id="rectangle" class="figure"
                             points="" />

                    <polygon id="triangle" class="figure"
                             points="" />


                    <text x="290" y="240">1</text>
                    <text x="330" y="240">2</text>
                    <text x="370" y="240">3</text>
                    <text x="410" y="240">4</text>
                    <text x="445" y="240">5</text>

                    <text x="205" y="240">-1</text>
                    <text x="165" y="240">-2</text>
                    <text x="125" y="240">-3</text>
                    <text x="85" y="240">-4</text>
                    <text x="40" y="240">-5</text>

                    <text x="256" y="215">1</text>
                    <text x="256" y="175">2</text>
                    <text x="256" y="135">3</text>
                    <text x="256" y="95">4</text>
                    <text x="256" y="55">5</text>

                    <text x="256" y="295">-1</text>
                    <text x="256" y="335">-2</text>
                    <text x="256" y="375">-3</text>
                    <text x="256" y="415">-4</text>
                    <text x="256" y="455">-5</text>
                </svg>
            </h:panelGrid>
        </h:panelGrid>

        <p:dataTable id="table" value="#{keeper.attempts}" var="element">
            <p:column headerText="X">
                <h:outputText value="#{element.point.x}" >
                    <f:convertNumber type="number" />
                </h:outputText>
            </p:column>

            <p:column headerText="Y">
                <h:outputText value="#{element.point.y}" >
                    <f:convertNumber type="number" />
                </h:outputText>
            </p:column>

            <p:column headerText="R">
                <h:outputText value="#{element.point.r}" >
                    <f:convertNumber type="number" />
                </h:outputText>
            </p:column>

            <p:column headerText="Hit">
                <h:outputText value="#{element.result}" >

                </h:outputText>
            </p:column>

            <p:column headerText="Start">
                <h:outputText value="#{element.start}" >

                </h:outputText>
            </p:column>

            <p:column headerText="Work Time, mcs">
                <h:outputText value="#{element.workTime}" >
                    <f:convertNumber type="number" />
                </h:outputText>
            </p:column>

        </p:dataTable>
        <br />
        <footer>
            <h:link value="Index" outcome="goToIndex" id="go-to-index-button"/>
        </footer>
    </h:body>
    <h:outputScript>
        drawAttempts(JSON.parse('#{keeper.jsonToDraw()}'));
    </h:outputScript>
    <p:remoteCommand name="addPoint" action="#{keeper.addFromJS}"
        update="table"/>
    <p:remoteCommand name="getR" action="#{attempt.getR}" />
    <p:remoteCommand name="update" action="#{attempt.update}" />
</html>